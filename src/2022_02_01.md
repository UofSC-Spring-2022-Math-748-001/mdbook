# Identities, projections, and convolutions

Let's expand out analogy with integral transforms in analysis a bit more. 
There are three nice properties of such linear transformations:
1. **Identity kernels**. Let 
$$ 
\Delta = \{ (x,x) \in X \times X \} 
$$
be the diagonal. Then, 
$$
\int_X \delta_{\Delta}(x,y) f(x) \ dx = f(y)
$$
for the $\delta$-function along $\Delta$. 
2. **Projection kernels**. For a kernel of the form $K(x,y) = e(x)h(y)$, 
we have 
$$
\int_X K(x,y) f(x) \ dx = h(y) \int_X e(x) f(x) \ dx 
$$
is a type of projection onto $h(y)$. 
3. **Composition as convolution**. For $K(x,y)$ and $Q(y,z)$ the composition 
of 
$$
f(x) \mapsto \int_X K(x,y) f(x) \ dx 
$$
and 
$$
f(y) \mapsto \int_Y Q(y,z) f(y) \ dy 
$$
is also an integral transformation with kernel 
$$
Q \star K := \int_Y K(x,y)Q(y,z) \ dy
$$ 

These three properties still hold integral transforms of derived categories.

## Identity Kernels 

Given a $k$-algebra $R$, we have a canonical exact sequence of $R \otimes_k R$
-modules 
$$
0 \to I \to R \otimes_k R \to R \to 0 
$$
This embeds $\operatorname{Spec} R$ as a closed subscheme of 
$\operatorname{Spec} R \times_{\operatorname{Spec} k} \operatorname{Spec} R$ 
cut out by the sheaf of ideals $\widetilde{I}$. 

For a morphism of schemes $X \to Y$, we have a corresponding map  
$$
\Delta : X \to X \times_Y X 
$$
as the diagram 
$$
\begin{CD}
X @>>1_X> X \\
@VV1_XV @VVV \\
X @>>> Y
\end{CD}
$$
commutes.

We set 
$$
\mathcal O_\Delta := \Delta_\ast \mathcal O_X. 
$$

**Proposition**. $\Phi_{\mathcal O_\Delta}$ is isomorphic to the identity functor. 

{{#proof}}
Suppressing the derived decoration, we have 
$$
\Phi_{\mathcal O_\Delta}(E) := \pi_{X\ast}(\pi_X^\ast E \otimes \Delta_\ast \mathcal O_X) 
$$
Using the projective formula, we get 
$$
\pi_{X\ast}(\pi_X^\ast E \otimes \Delta_\ast \mathcal O_X) \cong 
\pi_{X \ast}\Delta_\ast(\mathcal O_X \otimes \Delta^\ast \pi_X^\ast E) 
$$
From the universal property of the fiber product, we have 
$$
\pi_X \circ \Delta = 1_X 
$$
so 
$$
\pi_{X\ast} \Delta_{\ast} \cong \operatorname{Id}
$$
and 
$$
\Delta^\ast \pi^\ast \cong \operatorname{Id}. 
$$
{{/proof}}

## Projections Kernels 

Given $E \in D(\operatorname{Qcoh} X)$ and $F \in D(\operatorname{Qcoh} Y)$, 
we set 
$$
E \boxtimes_Z F := \pi_X^\ast E \otimes \pi_Y^\ast F
$$
Such an object is called an _external product_ of $E$ and $F$. We will omit $Z$ 
when the context is clear.

**Proposition**. Suppose $Z = \operatorname{Spec} k$ and $X$ and $Y$ are 
Tor-independent over $k$. If $E$ is compact, we have a natural isomorphism
$$
\Phi_{E^\vee \boxtimes F}(E') \cong \mathbf{R}\operatorname{Hom}(E,E') 
\overset{\mathbf{L}}{\otimes}_k F
$$

{{#proof}}
We have 
$$
\Phi_{E^\vee \boxtimes F}(E') := \pi_{Y\ast}(\pi_X^\ast E' \otimes 
\pi_X^\ast E^\vee \otimes \pi_Y^\ast F) 
$$
Using the projection formula gives
$$
\pi_{Y \ast} \pi_X^\ast (E^\vee \otimes E') \otimes F
$$
Since $E$ is compact, the natural map
$$
E^\vee \otimes E' \to \mathcal Hom(E,E') 
$$
is a quasi-isomorphism. 

From our assumptions, the Cartesian square 
$$
\begin{CD}
X \times_k Y @>>p_X> Y \\
@VVp_YV @VVV \\
X @>>> \operatorname{Spec} k 
\end{CD}
$$ 
is Tor-independent. Thus, 
$$
\pi_{Y \ast} \pi_X^\ast \mathcal Hom(E,E') \otimes F \cong p_X^\ast 
p_{Y \ast} \mathcal Hom (E,E') \otimes F
$$
And 
$$
p_{Y \ast} \mathcal Hom(E,E') \cong \operatorname{Hom}(E,E') 
$$
giving the result. 
{{/proof}}

In our analogy here with analysis, the Hom-spaces furnish the analog of a non-degenerate inner product. 

## Convolution of kernels 

Finally, given $Q \in D(\operatorname{Qcoh} X \times Y)$ and $K \in D(\operatorname{Qcoh} Y \times Z)$, 
we want to construct a object 
$$
K \star Q \in D(\operatorname{Qcoh} X \times Z) 
$$
such that 
$$
\Phi_K \circ \Phi_K \cong \Phi_{K \star Q}
$$

Let's label some maps 
$$
\pi_{X,Y} : X \times Y \times Z \to X \times Y \\
\pi_{Y,Z} : X \times Y \times Z \to Y \times Z \\
\pi_{X,Z} : X \times Y \times Z \to X \times Z
$$
and set 
$$
K \star Q := \pi_{X \times Z \ast} (\pi_{X \times Y}^\ast Q \otimes \pi_{Y \times Z}^\ast K) 
$$

**Proposition**. There is a natural isomorphism 
$$
\Phi_K \circ \Phi_K \cong \Phi_{K \star Q}
$$

We suppress the proof which is much like the previous few. We should note though that 
- $\star$ is associative and 
- $\mathcal O_\Delta$ is a two sided identity. 
